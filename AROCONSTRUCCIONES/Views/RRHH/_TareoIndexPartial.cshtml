@{
    // Recibimos la lista real del controlador
    var proyectos = ViewBag.Proyectos as SelectList;
}

<div class="pt-4">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-slate-700">
            <i class="fas fa-calendar-check mr-2 text-blue-600"></i>
            Control de Asistencia (Tareo)
        </h3>
    </div>

    <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200 mb-6">
        <div class="flex flex-col md:flex-row gap-4 items-end">
            <div class="w-full md:w-1/3">
                <label class="block text-sm font-medium text-slate-700 mb-1">Seleccionar Proyecto</label>

                <select id="selectProyectoTareo" class="form-select w-full border-slate-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500"
                        asp-items="proyectos">
                    <option value="0">-- Seleccione un Proyecto --</option>
                </select>

            </div>
            <div>
                <button id="btnNuevoTareo" type="button" disabled
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-slate-300 disabled:cursor-not-allowed transition-colors">
                    <i class="fas fa-plus mr-2"></i> Registrar Nuevo Día
                </button>
            </div>
        </div>
    </div>

    <div id="contenedorListaTareos">
        <div class="text-center text-slate-500 py-10 bg-slate-50 rounded border border-dashed border-slate-300">
            <i class="fas fa-arrow-up mb-2"></i>
            <p>Seleccione un proyecto para ver su historial de asistencia.</p>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        const $select = $('#selectProyectoTareo');
        const $btnNuevo = $('#btnNuevoTareo');
        const $contenedor = $('#contenedorListaTareos');

        $select.on('change', function() {
            const proyectoId = $(this).val();

            if (proyectoId > 0) {
                $btnNuevo.prop('disabled', false);
                $contenedor.html('<div class="p-4 text-center"><i class="fas fa-spinner fa-spin text-blue-600"></i> Cargando historial...</div>');

                $.get('@Url.Action("ListaTareos", "RRHH")', { proyectoId: proyectoId }, function(html) {
                    $contenedor.html(html);
                });

                $btnNuevo.off('click').on('click', function() {
                    const url = '@Url.Action("GetTareoForm", "RRHH")' + '?id=0&proyectoId=' + proyectoId;
                    const $dummy = $('<button>').attr('data-modal-url', url).hide();
                    $('body').append($dummy);
                    $dummy.click();
                    $dummy.remove();
                });
            } else {
                $btnNuevo.prop('disabled', true);
                $contenedor.html('<div class="text-center text-slate-500 py-10">Seleccione un proyecto.</div>');
            }
        });
    });
</script>