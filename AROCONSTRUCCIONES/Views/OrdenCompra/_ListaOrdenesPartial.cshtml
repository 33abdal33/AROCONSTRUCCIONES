@model IEnumerable<AROCONSTRUCCIONES.Dtos.OrdenCompraListDto>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="pt-4">
    <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold text-slate-700">
            <i class="fas fa-file-invoice mr-2 text-blue-600"></i>
            Gestión de Órdenes de Compra
        </h3>
        <button type="button"
                class="flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                data-modal-url="@Url.Action("CargarFormularioOC", "OrdenCompra")">
            <i class="fas fa-plus mr-2"></i> Nueva Orden de Compra
        </button>
    </div>

    <partial name="_MensajesTempDataPartial" />

    <div class="overflow-x-auto bg-white rounded-lg shadow">
        <table class="min-w-full divide-y divide-gray-200" id="dataTableOrdenesCompra">
            <thead class="bg-slate-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Código OC</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Proveedor</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Fecha Emisión</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Estado</th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Documento</th>
                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Total (S/)</th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Acciones</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @if (Model != null && Model.Any())
                {
                    @foreach (var orden in Model)
                    {
                        bool completado = orden.Estado == "Completado" || orden.Estado == "Cancelado";

                        string estadoClass = "bg-gray-100 text-gray-800"; // Gris (Default)
                        string estadoIcon = "fas fa-question-circle";

                        switch (orden.Estado)
                        {
                            case "Pendiente":
                                estadoClass = "bg-yellow-100 text-yellow-800"; // Naranja
                                estadoIcon = "fas fa-clock";
                                break;
                            case "Aprobado":
                                estadoClass = "bg-blue-100 text-blue-800"; // Azul
                                estadoIcon = "fas fa-thumbs-up";
                                break;
                            case "Recibido Parcial":
                                estadoClass = "bg-indigo-100 text-indigo-800"; // Indigo
                                estadoIcon = "fas fa-truck-loading";
                                break;
                            case "Completado":
                                estadoClass = "bg-green-100 text-green-800"; // Verde
                                estadoIcon = "fas fa-check-circle";
                                break;
                            case "Cancelado":
                                estadoClass = "bg-red-100 text-red-800"; // Rojo
                                estadoIcon = "fas fa-times-circle";
                                break;
                        }

                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">@orden.Codigo</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">@orden.ProveedorRazonSocial</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">@orden.FechaEmision.ToString("dd/MM/yyyy")</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full @estadoClass">
                                    <i class="@estadoIcon mr-1"></i>
                                    @orden.Estado
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                @if (!string.IsNullOrEmpty(orden.RutaPdf))
                                {
                                    <a href="@orden.RutaPdf" target="_blank" class="p-1 text-slate-500 hover:text-red-600" title="Ver PDF">
                                        <i class="fas fa-file-pdf fa-lg"></i>
                                    </a>
                                }
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 font-bold text-right">@orden.Total.ToString("N2")</td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium space-x-2">
                                <a href="#" class="p-1 text-slate-500 hover:text-blue-700" title="Ver Detalles">
                                    <i class="fas fa-eye"></i>
                                </a>
                                @if (!completado)
                                {
                                    <button type="button"
                                            class="p-1 text-slate-500 hover:text-green-700 btn-recepcionar"
                                            data-modal-url="@Url.Action("AbrirModalRecepcion", "OrdenCompra", new { id = orden.Id })"
                                            title="Recepcionar">
                                        <i class="fas fa-truck-loading"></i>
                                    </button>
                                }
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-slate-500">
                            No hay órdenes de compra para mostrar.
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>