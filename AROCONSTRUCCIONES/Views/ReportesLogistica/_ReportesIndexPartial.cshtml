@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="pt-2" x-data="{ selectedReport: 'kardex' }">
    <div class="mb-6 ps-2">
        <h2 class="text-2xl font-bold text-slate-800">Centro de Inteligencia</h2>
        <p class="text-sm text-slate-500 font-medium">Seleccione un reporte para configurar los parámetros de análisis.</p>
    </div>

    <div class="bg-white rounded-[2rem] border border-slate-200 shadow-xl shadow-slate-200/50 overflow-hidden flex flex-col md:flex-row min-h-[550px]">

        <div class="w-full md:w-80 bg-slate-50 border-r border-slate-200 p-6 flex flex-col gap-2">
            <p class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-4">Reportes Disponibles</p>

            <button @@click="selectedReport = 'kardex'"
                    :class="selectedReport === 'kardex' ? 'bg-white border-slate-200 text-indigo-600 shadow-sm' : 'border-transparent text-slate-500 hover:bg-slate-100'"
                    class="flex items-center gap-4 p-4 rounded-2xl border transition-all text-left group">
                <div :class="selectedReport === 'kardex' ? 'bg-indigo-100 text-indigo-600' : 'bg-slate-200 text-slate-400'"
                     class="w-10 h-10 rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-history text-sm"></i>
                </div>
                <div>
                    <p class="text-sm font-bold leading-tight">Kárdex Detallado</p>
                    <p class="text-[10px] font-medium opacity-70">Movimientos de stock</p>
                </div>
            </button>

            <button @@click="selectedReport = 'consumo'"
                    :class="selectedReport === 'consumo' ? 'bg-white border-slate-200 text-emerald-600 shadow-sm' : 'border-transparent text-slate-500 hover:bg-slate-100'"
                    class="flex items-center gap-4 p-4 rounded-2xl border transition-all text-left group">
                <div :class="selectedReport === 'consumo' ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-200 text-slate-400'"
                     class="w-10 h-10 rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-project-diagram text-sm"></i>
                </div>
                <div>
                    <p class="text-sm font-bold leading-tight">Consumo por Obra</p>
                    <p class="text-[10px] font-medium opacity-70">Gasto por proyecto</p>
                </div>
            </button>

            <button @@click="selectedReport = 'valorizacion'"
                    :class="selectedReport === 'valorizacion' ? 'bg-white border-slate-200 text-amber-600 shadow-sm' : 'border-transparent text-slate-500 hover:bg-slate-100'"
                    class="flex items-center gap-4 p-4 rounded-2xl border transition-all text-left group">
                <div :class="selectedReport === 'valorizacion' ? 'bg-amber-100 text-amber-600' : 'bg-slate-200 text-slate-400'"
                     class="w-10 h-10 rounded-xl flex items-center justify-center transition-colors">
                    <i class="fas fa-coins text-sm"></i>
                </div>
                <div>
                    <p class="text-sm font-bold leading-tight">Valorización</p>
                    <p class="text-[10px] font-medium opacity-70">Capital en almacén</p>
                </div>
            </button>
        </div>

        <div class="flex-1 p-8 md:p-12">

            <div x-show="selectedReport === 'kardex'" x-cloak class="animate-in fade-in slide-in-from-right-4 duration-300">
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-slate-800">Kárdex por Material</h4>
                    <p class="text-sm text-slate-500">Obtenga el historial completo de ingresos, salidas y saldos de un material específico.</p>
                </div>
                <form id="formReporteKardex" class="max-w-xl space-y-6">
                    <div class="space-y-2">
                        <label class="text-xs font-black text-slate-400 uppercase tracking-widest">Seleccionar Material</label>
                        <select id="kardexMaterialId" name="materialId" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold text-slate-700 focus:ring-4 focus:ring-indigo-500/10 transition-all" asp-items="@ViewBag.Materiales" required>
                            <option value="">Buscar material...</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-black text-slate-400 uppercase tracking-widest">Almacén de Origen</label>
                        <select id="kardexAlmacenId" name="almacenId" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold text-slate-700 focus:ring-4 focus:ring-indigo-500/10 transition-all" asp-items="@ViewBag.Almacenes" required>
                            <option value="">Seleccione almacén...</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full md:w-auto px-8 py-4 bg-indigo-600 text-white rounded-2xl font-bold text-sm shadow-lg shadow-indigo-200 hover:bg-indigo-700 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-file-export"></i> GENERAR REPORTE AHORA
                    </button>
                </form>
            </div>

            <div x-show="selectedReport === 'consumo'" x-cloak class="animate-in fade-in slide-in-from-right-4 duration-300">
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-slate-800">Consumo por Proyecto</h4>
                    <p class="text-sm text-slate-500">Analice qué materiales se han destinado a una obra específica y su costo acumulado.</p>
                </div>
                <form id="formReporteConsumoProyecto" class="max-w-xl space-y-6">
                    <div class="space-y-2">
                        <label class="text-xs font-black text-slate-400 uppercase tracking-widest">Obra / Proyecto Activo</label>
                        <select id="reporteProyectoId" name="proyectoId" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold text-slate-700 focus:ring-4 focus:ring-emerald-500/10 transition-all" asp-items="@ViewBag.Proyectos" required>
                            <option value="">Seleccione proyecto...</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full md:w-auto px-8 py-4 bg-emerald-600 text-white rounded-2xl font-bold text-sm shadow-lg shadow-emerald-200 hover:bg-emerald-700 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-chart-bar"></i> ANALIZAR COSTOS DE OBRA
                    </button>
                </form>
            </div>

            <div x-show="selectedReport === 'valorizacion'" x-cloak class="animate-in fade-in slide-in-from-right-4 duration-300">
                <div class="mb-8">
                    <h4 class="text-2xl font-bold text-slate-800">Valorización de Inventario</h4>
                    <p class="text-sm text-slate-500">Calcula el valor monetario actual de las existencias en almacén.</p>
                </div>
                <form id="formReporteStockValorizado" class="max-w-xl space-y-6">
                    <div class="space-y-2">
                        <label class="text-xs font-black text-slate-400 uppercase tracking-widest">Almacén (Filtrado opcional)</label>
                        <select id="almacenValorizadoId" name="almacenId" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold text-slate-700 focus:ring-4 focus:ring-amber-500/10 transition-all" asp-items="@ViewBag.Almacenes">
                            <option value="">🏢 Todos los Almacenes</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full md:w-auto px-8 py-4 bg-amber-600 text-white rounded-2xl font-bold text-sm shadow-lg shadow-amber-200 hover:bg-amber-700 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-dollar-sign"></i> CALCULAR VALOR TOTAL
                    </button>
                </form>
            </div>

            <div id="reporteResultadoContenedor" class="mt-12 pt-8 border-t border-slate-100">
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        function cargarReporte(formId, actionName, params) {
            const $contenedor = $('#reporteResultadoContenedor');
            const $boton = $(formId).find('button[type="submit"]');
            const originalHtml = $boton.html();

            $boton.prop('disabled', true).addClass('opacity-70').html('<i class="fas fa-circle-notch fa-spin mr-2"></i> Generando...');
            $contenedor.html('<div class="flex justify-center p-20"><i class="fas fa-spinner fa-spin fa-3x text-indigo-500"></i></div>');

            const url = '/ReportesLogistica/' + actionName;

            $.get(url, params, function(data) {
                $contenedor.html(data);
                if (typeof initializeDataTables === "function") { initializeDataTables(); }
            })
            .fail(function() {
                $contenedor.html('<div class="text-center text-rose-500 p-10 font-bold">Error al procesar el reporte.</div>');
            })
            .always(function() {
                $boton.prop('disabled', false).removeClass('opacity-70').html(originalHtml);
            });
        }

        $('#formReporteKardex').on('submit', function(e) {
            e.preventDefault();
            cargarReporte('#formReporteKardex', 'GenerarReporteKardex', { materialId: $('#kardexMaterialId').val(), almacenId: $('#kardexAlmacenId').val() });
        });

        $('#formReporteConsumoProyecto').on('submit', function(e) {
            e.preventDefault();
            cargarReporte('#formReporteConsumoProyecto', 'GenerarReporteConsumoProyecto', { proyectoId: $('#reporteProyectoId').val() });
        });

        $('#formReporteStockValorizado').on('submit', function(e) {
            e.preventDefault();
            cargarReporte('#formReporteStockValorizado', 'GenerarReporteStockValorizado', { almacenId: $('#almacenValorizadoId').val() });
        });
    });
</script>