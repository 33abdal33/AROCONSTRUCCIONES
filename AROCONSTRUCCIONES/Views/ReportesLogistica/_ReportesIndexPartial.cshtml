@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="pt-4">
    <h3 class="text-xl font-semibold text-slate-700 mb-4">
        <i class="fas fa-chart-pie mr-2 text-blue-600"></i>
        Módulo de Reportes de Logística
    </h3>

    <div class="bg-white rounded-lg shadow-md mb-6">
        <div class="border-b border-gray-200 p-4">
            <strong class="text-slate-700"><i class="fas fa-history mr-2"></i>Reporte: Kárdex por Material</strong>
        </div>
        <div class="p-4">
            <form id="formReporteKardex">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                    <div>
                        <label for="kardexMaterialId" class="block text-sm font-medium text-gray-700">Material</label>
                        <select id="kardexMaterialId" name="materialId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" asp-items="@ViewBag.Materiales" required>
                            <option value="">Seleccione un material...</option>
                        </select>
                    </div>
                    <div>
                        <label for="kardexAlmacenId" class="block text-sm font-medium text-gray-700">Almacén</label>
                        <select id="kardexAlmacenId" name="almacenId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" asp-items="@ViewBag.Almacenes" required>
                            <option value="">Seleccione un almacén...</option>
                        </select>
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-blue-700">
                            <i class="fas fa-search mr-2"></i> Generar Reporte
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="reporteResultadoContenedor">
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#formReporteKardex').on('submit', function(e) {
            e.preventDefault();

            const $form = $(this);
            const $contenedor = $('#reporteResultadoContenedor');
            const $boton = $form.find('button[type="submit"]');

            const materialId = $('#kardexMaterialId').val();
            const almacenId = $('#kardexAlmacenId').val();

            if (!materialId || !almacenId) {
                Swal.fire({ icon: 'warning', title: 'Campos requeridos', text: 'Por favor, seleccione un material y un almacén.' });
                return;
            }

            // Spinner (Tailwind)
            $boton.prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-2"></i> Generando...');
            $contenedor.html('<div class="flex justify-center items-center p-5"><i class="fas fa-spinner fa-spin fa-2x text-blue-500"></i></div>');

            const url = '@Url.Action("GenerarReporteKardex", "ReportesLogistica")';

            $.get(url, { materialId: materialId, almacenId: almacenId }, function(data) {
                $contenedor.html(data);

                // ¡LÍNEA CORREGIDA!
                // Llama a la función global de logistica-tabs.js
                initializeDataTables();
            })
            .fail(function(xhr) {
                $contenedor.html(''); // Limpia el spinner
                Swal.fire({ icon: 'error', title: 'Error', text: 'No se pudo generar el reporte: ' + xhr.responseText });
            })
            .always(function() {
                $boton.prop('disabled', false).html('<i class="fas fa-search mr-2"></i> Generar Reporte');
            });
        });
    });
</script>